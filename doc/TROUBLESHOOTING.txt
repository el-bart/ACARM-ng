troubleshooting
===============

here are some issues you might find during installation, configuration and
usage of ACARM-ng along with typical solutions.


system does not compile
========================
check if you have latest version of sources. check if you have all required
prerequisites installed (list in REQUIREMENTS.txt) in proper versions. if
everything fails, contact system authors (see project's home page).


source compiles with warnings
=============================
send us report from compilation along with you environment details (compiler
type and version, libraries versions, build configuration, system).


graphs (images) do not show in WUI
==================================
there can be multiple reasons for this, since images are generated at runtime.
to see error message generated by the image, show the image (link is in
page source in the WUI; on some browsers is is enough to right-click on place
where image is and select 'view image' or similar). here are some hints on
what can be happening:
 1. php-gd library is missing (on debian: apt-get install php5-gd)
 2. fonts are missing (on debian: apt-get install ttf-mscorefonts-installer)
 3. on some systems fonts are present but are expected to be elsewhere. try
    to add some links:
    cd /usr/share/fonts/truetype/ && ls -s msttcorefonts/*ttf .


missing *.so objects when running
=================================
you don't have LD_LIBRARY_PATH set correctly - ACARM-ng uses libraries that
are essential to run application (/home/acarm-ng/libs in previous examples).


configuration file's syntax problems
====================================
here is minimal, valid configuration. note: its useless for production,
since it does nothing (except for logging to file), but can be easily
expanded, step by step, to help find what your problem is. file's content:
     <?xml version="1.0" encoding="UTF-8"?>
     <acarm_ng>

       <general>
         <url>https://url.to.wui</url>
         <cleanupInterval>8</cleanupInterval>
         <cleanupOlder>90</cleanupOlder>
         <pluginsDir>/my/path</pluginsDir>
       </general>

       <persistency>
         <type>stubs</type>
       </persistency>

       <logger>
         <appenders>
           <File name="default">
             <output>loggerfile.log</output>
           </File>
         </appenders>

         <nodes appender="default" threshold="debug">
         </nodes>
       </logger>

       <preprocessor/>

       <filters/>

       <triggers/>

       <inputs/>

     </acarm_ng>


Assertion `*lock == ((ath_mutex_t) 0)'
======================================
if you get following asseratiuon failed:

acarmng: ath.c:186: _gcry_ath_mutex_lock: Assertion `*lock == ((ath_mutex_t) 0)'

this appears to be a bug in vmime 0.8.1. installing 0.9.1 (latest stabel as of
december 2010) solves the problem.


FATAL: connection limit exceeded for non-superusers
===================================================
this is an error message generated by PostgreSQL server, when connection limit is exceeded.
since ACARM-ng opens many connections, default limit, set on some of the distributions, is
not enough. for example on CentOS 6.0 it is set to 10. in order to fix the problem edit
configuration files of the data base server and set higher value - max_connections=100.

in general ACARM-ng needs at least one connection per each trigger and filter, plus few
spare connections for other tasks (cleanup, initial setup, etc...). if you use WUI, some
connections must be reserved for that purpose as well.


problems with certificate validation
====================================
when using e-mail sending functionality, with valid certificates, while still
getting errors like this:
error: certificate validation failed: Cannot verify certificate against trusted certificates.
upgrading libgnutls to the required version is known to help.


found a bug?
============
compile ACARM-ng in debug profile and check again - logging is much more
verbose then and extra assertions are present in the code. to do this run:
$ ./configure --debug --prefix /my/debug/installation/dst/dir
$ make
$ make install
now you'll have full information on what is happening inside the system.
also make sure you have the latest, stable versions of dependent libraries
installed on your system.
if what you have found appears to be a bug, please report it.


cannot connect with prelude-client
==================================
ensure that registration was made the right way. for most usages it should be
something like this:
(on prelude-manager server)
prelude-adduser registration-server prelude-manager
(on ACARM-ng host)
prelude-adduser register acarm-ng_profile "idmef:r" 127.0.0.1 --uid XXX --gid YYY
where XXX and YYY are ACARM-ng's user UID and GID, respectively. unfortunately
Prelude is not too verbose about it's internal errors so one must pay a lot of
attention on what is going on during configuration.
